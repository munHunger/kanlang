Complete rewrite without dependencies, and using nx
